<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HEIC to JPEG Converter</title>
    <meta name="theme-color" content="#317EFB" />
    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="icons/icon-192x192.png" />
    <!-- Библиотека для конвертации HEIC -->
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
  </head>
  <body>
    <!-- #################### ОСНОВНАЯ СТРАНИЦА #################### -->
    <main id="main-page" class="page active">
      <header>
        <h1>HEIC to JPEG</h1>
        <div class="header-buttons">
          <button id="theme-toggle-btn" class="icon-btn" title="Сменить тему">
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>
          <button id="settings-btn" class="icon-btn" title="Настройки">
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="3"></circle>
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
              ></path>
            </svg>
          </button>
        </div>
      </header>

      <div class="converter-area">
        <div id="drop-zone" class="drop-zone">
          <p>Перетащите .HEIC файлы сюда или нажмите для выбора</p>
          <input
            type="file"
            id="file-input"
            multiple
            accept=".heic,.heif"
            hidden
          />
        </div>

        <div class="controls">
          <label for="quality-slider"
            >Качество JPEG: <span id="quality-value">90</span>%</label
          >
          <input
            type="range"
            id="quality-slider"
            min="10"
            max="100"
            value="90"
          />
          <button id="convert-btn" class="button" disabled>
            Конвертировать
          </button>
        </div>

        <!-- Прогресс бар -->
        <div
          id="progress-container"
          class="progress-container"
          style="display: none"
        >
          <div class="progress-bar-wrapper">
            <div id="progress-bar" class="progress-bar"></div>
          </div>
          <span id="progress-text"></span>
        </div>
      </div>

      <div id="gallery-container" class="gallery-container">
        <div class="gallery-header" style="display: none">
          <h2>Результаты</h2>
          <button id="download-all-btn" class="button-secondary">
            Скачать всё
          </button>
        </div>
        <div id="gallery" class="gallery"></div>
      </div>
    </main>

    <!-- #################### СТРАНИЦА НАСТРОЕК #################### -->
    <div id="settings-page" class="page">
      <header>
        <h1>Настройки</h1>
        <button id="back-btn" class="icon-btn" title="Назад">
          <svg
            class="icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
        </button>
      </header>
      <div class="settings-content">
        <div class="setting-item">
          <label for="default-quality-slider"
            >Качество JPEG по умолчанию:
            <span id="default-quality-value">90</span>%</label
          >
          <input
            type="range"
            id="default-quality-slider"
            min="10"
            max="100"
            value="90"
          />
        </div>
        <div class="setting-item">
          <label>Метод сохранения</label>
          <div class="toggle-switch-container">
            <span>Загрузка через браузер</span>
            <label class="toggle-switch">
              <input type="checkbox" id="save-method-toggle" />
              <span class="slider round"></span>
            </label>
            <span>Прямое сохранение</span>
          </div>
          <small id="fs-api-support" class="tooltip"></small>
        </div>
        <div class="setting-item">
          <label for="save-path-btn">Папка для сохранения</label>
          <button id="save-path-btn" class="button-secondary">
            Выбрать папку
          </button>
          <p>Текущий путь: <code id="current-save-path">не выбрана</code></p>
        </div>
      </div>
    </div>

    <!-- #################### ПРОСМОТР ИЗОБРАЖЕНИЯ (МОДАЛЬНОЕ ОКНО) #################### -->
    <div id="viewer-modal" class="modal-overlay" style="display: none">
      <button id="close-viewer-btn" class="icon-btn close-btn">
        <svg
          class="icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <button id="prev-btn" class="icon-btn nav-btn prev">
        <svg
          class="icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <div class="modal-content">
        <img id="viewer-img" src="" alt="Просмотр изображения" />
        <div class="image-info">
          <p id="viewer-filename">filename.jpg</p>
          <p id="viewer-sizes">0.00 MB → 0.00 MB</p>
          <button id="viewer-download-btn" class="button">Скачать</button>
        </div>
      </div>
      <button id="next-btn" class="icon-btn nav-btn next">
        <svg
          class="icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>

    <footer>
      <p id="version-display"></p>
    </footer>

    <!-- Подключаем основной скрипт приложения -->
    <script src="script.js" defer></script>
  </body>
</html>
